# 機能仕様書（Specification）テンプレート

> **このドキュメントはテンプレートです。**  
> 各プロジェクトの機能に合わせてカスタマイズして使用してください。  
> 本サンプルでは「ユーザーログイン機能」を例に記載しています。

---

## 1. 機能名
ユーザーログイン機能

---

## 2. 機能の詳細
- ユーザーがメールアドレスとパスワードを入力して、認証に成功した場合はアプリケーションにログインできる。  
- 認証にはJWTトークンを利用し、セッション管理を行う。  
- ログイン成功後、ユーザー情報をセッションに保存し、マイページへ遷移する。  

---

## 3. 入力の定義と制約条件
- **入力項目**  
  - メールアドレス（string, 必須, 最大255文字, RFC 5322準拠）  
  - パスワード（string, 必須, 8〜64文字, 英数字＋特殊文字を含むこと）  

- **制約条件**  
  - 両方の入力が必須。  
  - フロントエンドでバリデーションを行い、不正な形式の場合はAPIを呼び出さない。  
  - 入力値はSQLインジェクションやXSS対策済みでAPIに送信する。  

---

## 4. 処理の流れと条件分岐
1. ユーザーがログイン画面でメールアドレスとパスワードを入力  
2. 入力形式をクライアント側でバリデーション  
   - NG → 「入力形式エラー」を表示（API未呼び出し）  
3. API `/auth/login` に対してPOSTリクエストを送信  
4. サーバー側で以下をチェック  
   - 入力されたメールアドレスがDBに存在するか  
     - 存在しない → エラー（コード: `USER_NOT_FOUND`）  
   - パスワードが一致するか  
     - 一致しない → エラー（コード: `INVALID_PASSWORD`）  
   - アカウントがロック状態か  
     - ロック中 → エラー（コード: `ACCOUNT_LOCKED`）  
5. 認証成功時  
   - JWTトークンを生成しレスポンスとして返却  
   - ユーザー情報を返却（id, name, roleなど）  
6. クライアント側でセッションストレージにトークンを保存し、マイページへ遷移  

---

## 5. 出力形式とサンプル
- **成功時（200 OK）**
```json
{
  "status": "success",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6...",
  "user": {
    "id": 12345,
    "name": "Taro Yamada",
    "role": "user"
  }
}
```

- **失敗時（400/401/403）**
```json
{
  "status": "error",
  "code": "INVALID_PASSWORD",
  "message": "パスワードが正しくありません"
}
```

---

## 6. エラーケースの取扱い
| ケース | エラーコード | ステータス | 表示メッセージ |
|--------|-------------|------------|----------------|
| ユーザーが存在しない | USER_NOT_FOUND | 404 | 登録されていないメールアドレスです |
| パスワード不一致 | INVALID_PASSWORD | 401 | パスワードが正しくありません |
| アカウントロック | ACCOUNT_LOCKED | 403 | アカウントがロックされています |
| 入力形式エラー | INVALID_INPUT | 400 | 入力値の形式が不正です |

---

## 7. テストケースの説明
- **正常系**
  1. 正しいメールアドレス・パスワードでログインできること  
  2. JWTトークンが返却され、セッションに保存されること  

- **異常系**
  1. メールアドレス未登録 → `USER_NOT_FOUND` が返ること  
  2. パスワード不一致 → `INVALID_PASSWORD` が返ること  
  3. アカウントロック状態 → `ACCOUNT_LOCKED` が返ること  
  4. 入力形式が不正（例：メールアドレスに@がない） → `INVALID_INPUT` が返ること  

- **境界値テスト**
  1. パスワード最小文字数（8文字）の場合にログインできること  
  2. パスワード最大文字数（64文字）の場合にログインできること  
  3. メールアドレス最大文字数（255文字）の場合に正しく処理されること  

---
